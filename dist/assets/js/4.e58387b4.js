(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{161:function(t,s,a){t.exports=a.p+"assets/img/swoole.fe7d24b5.jpg"},162:function(t,s,a){t.exports=a.p+"assets/img/process1.73588dc2.png"},163:function(t,s,a){t.exports=a.p+"assets/img/process.bd822ec4.jpg"},186:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"server详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server详解","aria-hidden":"true"}},[this._v("#")]),this._v(" Server详解")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"启动server流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动server流程图","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动server流程图")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下图是官方的启动server的流程图\n"),s("img",{attrs:{src:a(161),alt:"server启动流程图"}}),this._v("\n之前的入门篇介绍了创建一个http-server和websocket-server，这两种server都是继承自"),s("code",[this._v("swoole\\server")]),this._v("的，所以下面讲的同样适用swoole入门篇的server")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("实例化server对象，需要设定绑定ip和端口号")]),this._v(" "),s("li",[this._v("设置server启动前的配置选项")]),this._v(" "),s("li",[this._v("注册不同事件回调处理函数，官方文档中支持13种事件")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"server的进程模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server的进程模型","aria-hidden":"true"}},[this._v("#")]),this._v(" Server的进程模型")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Swoole"),a("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Server")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'0.0.0.0'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("9501")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("SWOOLE_PROCESS")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("SWOOLE_SOCK_TCP")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'start'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'master进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("master_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'manager进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("manager_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("var_dump")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("setting")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'WorkerStart'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$worker_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("taskworker")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'taskWorker进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("worker_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'worker进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("worker_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("start")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在命令行中输入"),s("code",[this._v("php server.php")]),this._v("启动server，在命令行会看到如下的打印信息")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("master进程ID：640\nmanager进程ID：641\narray"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("4"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"worker_num"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("4"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"task_worker_num"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"buffer_output_size"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2097152"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"max_connection"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  int"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("7168"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nworker进程ID：642\nworker进程ID：643\nworker进程ID：644\nworker进程ID：645\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用"),s("code",[this._v("ps aux | grep server.php")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("simon              656   0.0  0.0  4286452    832 s001  S+    1:19PM   0:00.00 "),a("span",{attrs:{class:"token function"}},[t._v("grep")]),t._v(" --color"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("auto --exclude-dir"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(".bzr --exclude-dir"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("CVS --exclude-dir"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(".git --exclude-dir"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(".hg --exclude-dir"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(".svn server.php\nsimon              645   0.0  0.0  4375576   3196 s002  S+    1:19PM   0:00.00 php server.php\nsimon              644   0.0  0.0  4367384   3244 s002  S+    1:19PM   0:00.00 php server.php\nsimon              643   0.0  0.0  4375576   3192 s002  S+    1:19PM   0:00.00 php server.php\nsimon              642   0.0  0.0  4375576   3196 s002  S+    1:19PM   0:00.00 php server.php\nsimon              641   0.0  0.0  4377504    620 s002  S+    1:19PM   0:00.00 php server.php\nsimon              640   0.0  0.4  4389680  30768 s002  S+    1:19PM   0:00.14 php server.php\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用命令"),s("code",[this._v("pstree -p 640")]),this._v("，640为之前的master进程ID，打印出如下信息")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 00001 root /sbin/launchd\n \\-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 93751 simon /Applications/iTerm.app/Contents/MacOS/iTerm2\n   \\-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 94118 simon /Applications/iTerm.app/Contents/MacOS/iTerm2 --server login -fp simon\n     \\-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 94119 root login -fp simon\n       \\-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 94120 simon -zsh\n         \\-+"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" 00640 simon php server.php\n           \\-+- 00641 simon php server.php\n             "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("--- 00642 simon php server.php\n             "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("--- 00643 simon php server.php\n             "),a("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v("--- 00644 simon php server.php\n             \\--- 00645 simon php server.php\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以很清楚的看到进程之间的关系，下面看一下官方给出的进程结构图\n"),s("img",{attrs:{src:a(162),alt:"进程结构图"}}),this._v("\n下图为官方给出的各种进程的主要处理的任务\n"),s("img",{attrs:{src:a(163),alt:"进程功能图"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("Master：是一个多线程程序")]),this._v(" "),s("li",[this._v("Manager")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("专门负责worker/task进程的fork操作和管理, manager的任务本来可以由master进程来负责，对于多线程的Master进程而言，想要多Worker进程就必须fork操作。通常，worker进程被误杀或者由于业务代码出现异常的原因会导致进程异常退出，Manager进程为了保证设计上master进程的稳定，将worker进程管理交给了manager进程")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("worker/taskWorker：")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("worker：主要业务逻辑都是都是在worker进程中处理")]),this._v(" "),s("li",[this._v("task：耗时任务一般都会在worker进程中将任务投递给这个进程处理")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"事件回调函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件回调函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 事件回调函数")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("onStart")]),t._v(" "),a("li",[t._v("onShutDown")]),t._v(" "),a("li",[t._v("onManagerStart")]),t._v(" "),a("li",[t._v("onManagerStop")]),t._v(" "),a("li",[t._v("onWorkerStart")]),t._v(" "),a("li",[t._v("onWorkerError")]),t._v(" "),a("li",[t._v("onWorkerExit")]),t._v(" "),a("li",[t._v("onWorkerStop")]),t._v(" "),a("li",[t._v("onTask")]),t._v(" "),a("li",[t._v("onFinish")]),t._v(" "),a("li",[t._v("onConnect")]),t._v(" "),a("li",[t._v("onReceive")]),t._v(" "),a("li",[t._v("onClose")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Swoole"),a("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Server")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'0.0.0.0'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("9501")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("SWOOLE_PROCESS")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("SWOOLE_SOCK_TCP")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("set")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'worker_num'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'task_worker_num'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'reload_async'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 下面所有事件回调的详细介绍请查看官方文档，以更加全面了解")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'start'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了Start事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'master进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("master_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'manager进程ID：'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("manager_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 整个服务停止时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'ShutDown'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了ShutDown事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// manager进程启动时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'ManagerStart'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了ManagerStart事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// manager进程结束时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'ManagerStop'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了ManagerStop事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// worker/taskWorker进程启动时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'WorkerStart'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$worker_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了WorkerStart事件回调，'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("taskworker")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'taskWorker进程PID为'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("worker_pid")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Worker进程PID为'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("worker_pid")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 使用php的Fatal Error模拟进程异常退出的错误，进程出错就可以触发WorkerError事件回调")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 一般情况都会在业务代码使用try catch捕获异常，防止进程异常重启")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 使用命令：php server.php >> test.txt   将命令行打印的信息输出到文本文件中查看")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// new fsfsdfds();")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// worker/taskWorker进程异常触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'WorkerError'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$worker_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了WorkerError事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'WorkerExit'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了WorkerExit事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 进程结束会触发此回调函数")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'WorkerStop'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$worker_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"触发了WorkerStop事件回调"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Task'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$task_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$src_worker_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'接收到了worker进程投递过来的任务，收到投递任务时发送的信息如下'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("var_dump")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// 通知worker进程任务处理完成")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("sleep")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("finish")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'task finish'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 任务完成后的回调处理函数")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Finish'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$task_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string "),a("span",{attrs:{class:"token variable"}},[t._v("$data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'接收到了任务完成的通知，任务完成传递过来的数据如下'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("var_dump")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 客户端建立连接时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Connect'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$fd")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$reactorId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了Connect事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 收到客户端发送过来的数据时触发的回调，")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("//如果启动的是udp服务，监听的是onPacket事件")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Receive'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$fd")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$reactor_id")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string "),a("span",{attrs:{class:"token variable"}},[t._v("$data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了Receive事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("task")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'发送给taskWorker进程的数据'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 客户端或者服务端断开连接时触发的回调")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("on")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Close'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Swoole\\"),a("span",{attrs:{class:"token package"}},[t._v("Server")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$server")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$fd")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" int "),a("span",{attrs:{class:"token variable"}},[t._v("$reactorId")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'触发了Close事件回调'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("PHP_EOL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token variable"}},[t._v("$serv")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("start")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用命令"),s("code",[this._v("php server.php")]),this._v("启动TCPServer，会有如下打印信息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("触发了ManagerStart事件回调\n触发了Start事件回调\nmaster进程ID：32855\nmanager进程ID：32856\n触发了WorkerStart事件回调，taskWorker进程PID为32857\n触发了WorkerStart事件回调，Worker进程PID为32858\n触发了WorkerStart事件回调，Worker进程PID为32859\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在新的命令行窗口通过使用"),s("code",[this._v("kill -USR1 32855")]),this._v("命令向主进程发送平滑重启worker和taskWorker进程，之前命令行会新增如下打印")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("触发了WorkerStop事件回调\n触发了WorkerStop事件回调\n触发了WorkerStop事件回调\n触发了WorkerStart事件回调，Worker进程PID为33723\n触发了WorkerStart事件回调，Worker进程PID为33724\n触发了WorkerStart事件回调，taskWorker进程PID为33725\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$client")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("swoole_client")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token constant"}},[t._v("SWOOLE_SOCK_TCP")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token variable"}},[t._v("$client")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("connect")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'127.0.0.1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("9501")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("exit")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"connect failed. Error: '),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token variable"}},[t._v("$client")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("errCode")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$client")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("send")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"hello world\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token variable"}},[t._v("$client")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("close")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用命令"),s("code",[this._v("php client.php")]),this._v("，会看到之前开启server的命令行窗口新增打印如下信息")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("触发了Connect事件回调\n触发了Receive事件回调\n触发了Close事件回调\n接收到了worker进程投递过来的任务，收到投递任务时发送的信息如下\nstring"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("34"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"发送给taskWorker进程的数据"')]),t._v("\n接收到了任务完成的通知，任务完成传递过来的数据如下\nstring"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("11"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"task finish"')]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下面通过使用命令"),s("code",[this._v("kill -SIGTERM 32855")]),this._v("向master进程发送安全终止的信号，之前的server命令行窗口会新增如下打印信息")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("触发了WorkerStop事件回调\n触发了WorkerStop事件回调\n触发了WorkerStop事件回调\n触发了ManagerStop事件回调\n触发了ShutDown事件回调\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"server启动配置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server启动配置项","aria-hidden":"true"}},[this._v("#")]),this._v(" server启动配置项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("进程数和最大连接数相关配置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("reactor-num：主进程内事件处理线程的数量，充分利用cpu资源，默认会和CPU核数一样")]),t._v(" "),a("li",[t._v("worker_num：启动的worker进程数")]),t._v(" "),a("li",[t._v("max_request：worker进程的最大任务数，主要作用是解决php进程内存溢出问题")]),t._v(" "),a("li",[t._v("max_conn：最大允许维持多少个TCP连接")]),t._v(" "),a("li",[t._v("task_worker_num：耗时任务taskWoker进程的个数")]),t._v(" "),a("li",[t._v("task_max_request：taskWorker进程的最大任务数，同max_request作用一样")]),t._v(" "),a("li",[t._v("task_tmpdir：投递任务时传递数据超过8180自己的，将会是用临时文件来存储数据，这个是设置临时文件的存放目录")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("worker进程和taskWorker进程通信模式相关配置")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("task_ipc_mode：worker和taskWorker进程通信方式，默认是使用unix socket通信")]),this._v(" "),s("li",[this._v("message_queue_key：task_ipc_mode使用消息队列的方式，那么需要通过这个来设置消息队列的key值")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("工作进程安全性相关\n具体的业务逻辑都是通过worker和taskWorker进程来处理的，如果代码存在漏洞，服务器的安全性就会降低，linux系统通过用户和用户组来控制权限，存在代码漏洞的情况下，也不至于服务器很容易被攻破")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("user：设置worker和taskWorker进程所属用户")]),this._v(" "),s("li",[this._v("group：设置worker和taskWorker进程所属用户组")]),this._v(" "),s("li",[this._v("chroot：设置worker/taskWorker进程的根目录，作用是隔离操作系统其它的目录")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("cpu亲和性设置")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("open_cpu_affinity：启用CPU亲和性设置，此特性会将swoole的reactor线程/worker进程绑定到固定的一个核上。可以避免进程/线程的运行时在多个核之间互相切换")]),this._v(" "),s("li",[this._v("cpu_affinity_ignore：用于设置不占用哪些CPU")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("日志文件等的配置")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("daemonize：让服务以守护进程的方式启动")]),t._v(" "),a("li",[t._v("reload_async：设置异步重启，启用次特性，worker进程会等待异步事件完成后再重启进程")]),t._v(" "),a("li",[t._v("pid_file：server启动时会将master进程的pid写入到此文件")]),t._v(" "),a("li",[t._v("log_file：设置运行期间的错误日志文件")]),t._v(" "),a("li",[t._v("log_level：设置什么等级的错误会被抛出")]),t._v(" "),a("li",[t._v("request_slowlog_file")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"6"}},[s("li",[this._v("ssl隧道加密相关\n当通信协议需要使用https、wss时，需要通过下面这些来设置证书。通常生产环境，证书的设置都会放在nginx来管理，nginx再把请求代理到上游服务器")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("ssl_cert_file")]),t._v(" "),a("li",[t._v("ssl_key_file")]),t._v(" "),a("li",[t._v("ssl_method")]),t._v(" "),a("li",[t._v("ssl-ciphers")]),t._v(" "),a("li",[t._v("ssl-verify-peer")]),t._v(" "),a("li",[t._v("ssl_client_cert_file")]),t._v(" "),a("li",[t._v("ssl_allow_self_signed")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"7"}},[s("li",[this._v("协程相关配置")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("enable_coroutine：是否开启事件回调中自动创建协程，影响的事件回调请看官方文档")]),this._v(" "),s("li",[this._v("max_coroutine：设置当前worker进程能创建的最大协程数量")]),this._v(" "),s("li",[this._v("task_enable_coroutine：设置当前taskWorker进程能创建的最大协程数量，这个特性在V4.2.12版本才支持")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("swoole也可以使用代码的方式来创建协程，这样灵活性相对于配置的方式会更好，我只需要在我需要用到协程的地方用代码开启\n8. 协议相关配置\n之前入门篇内容的http-server、ws-server，启动服务式，onStart事件回调中将"),s("code",[this._v("$server->setting")]),this._v("打印出来，就可以看到，没通过set方法设置配置项，但是会打印出很多配置项，其中就有下面这些配置项，可以自行去修改之前的入门篇的server代码，将配置项打印出来查看")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("open_http_protocol")]),t._v(" "),a("li",[t._v("open_http2_protocol")]),t._v(" "),a("li",[t._v("open_websocket_protocol")]),t._v(" "),a("li",[t._v("open_mqtt_protocol")]),t._v(" "),a("li",[t._v("open_websocket_close_frame")])])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("启动server前通常需要做以下三个步骤")]),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("图中$serv->start()后，会存在三种类型的进程（master，manager，worker、taskWorker），下节通过启动一个server，结合ps和pstree命令来查看启动server之后的进程结构")]),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("Server存在"),a("a",{attrs:{href:"https://wiki.swoole.com/wiki/page/353.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("两种运行模式"),a("OutboundLink")],1),t._v("，单线程模式和进程模式，下面我们只介绍进程模式")]),t._v(" "),a("p",[t._v("先看如下server.php代码")]),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),a("p",[t._v("代码中其实没有指定任何的server配置项，但是确打印出来了4个配置项，而且其中的worker进程的数量为4")]),t._v(" "),t._m(8),t._v(" "),t._m(9),a("p",[t._v("第一行使用grep命令产生的进程可以忽略，可以看到第二列的进程ID和之前启动server时打印的进程ID一致，而且worker进程的个数为swoole扩展自己定义")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),a("p",[t._v("总结：")]),t._v(" "),a("p",[t._v("swoole启动一个Server后，会存在2+N+M个进程，N表示worker进程的个数，M为taskWorker进程个数")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("swoole所使用的这种进程架构模型，创始人韩天峰-Rango在慕课网写了一篇手记文章来深度讲述，请移步"),a("a",{attrs:{href:"https://www.imooc.com/article/8449",target:"_blank",rel:"noopener noreferrer"}},[t._v("慕课网手记传送门"),a("OutboundLink")],1),t._v("阅读")]),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("之前慕课手机那篇文章中介绍到请求过来最后都会转化成一个事件，根据绑定的事件回调函数来进行处理。结合入门篇讲到的http-server的onRequest事件回调，websocket-server的onHandShake、onOpen、onMessage事件回调，还有如下事件回调")]),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("下面以代码来演示一下各个事件的触发，server.php代码如下")]),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),a("p",[t._v("再通过一个swoole扩展提供的client客户端来连接前面启动的server，client.php代码如下")]),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),a("p",[t._v('string(11) "task finish"，这行信息会延迟3秒打印，使用sleep(3)来模拟耗时操作，worker进程和taskWorker进程都是用来处理业务逻辑的进程，而taskWorker是专门用来处理这种耗时任务的')]),t._v(" "),t._m(27),t._v(" "),t._m(28),a("p",[t._v("上面演示了一个server启动到终止的完整生命周期，其中WorkerExit事件一直没有触发，暂未找到问题，不知道是不是一个bug。")]),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("官方文档中的配置项，大概有以下几类，这里只做大概介绍，细节请移步"),a("a",{attrs:{href:"https://wiki.swoole.com/wiki/page/274.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1)]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),a("p",[t._v("其它没有提到的都是一些和TCP底层相关配置项，这块内容讲起来需要很多前置知识，对于web开发来说基本也用不上，这里就不做介绍，需要了解请自行查看官方文档")]),t._v(" "),a("p",[t._v("总结：")]),t._v(" "),a("p",[t._v("Server篇以多线程+多进程的架构为主线，结合事件回调和启动前的配置项，来理解server启动背后发生了什么。官方文档还详细介绍了server的属性和方法，这些内容请移步文档中查看。")])])},n,!1,null,null,null);r.options.__file="server.md";s.default=r.exports}}]);